{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "SSH to Hetzner VPS",
      "type": "shell",
      "command": "ssh",
      "args": ["hetzner"],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Deploy: SCP Files to VPS",
      "type": "shell",
      "command": "scp",
      "args": [
        "${file}",
        "hetzner:/var/www/offmetabg/${relativeFile}"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Deploy: Git Pull on VPS",
      "type": "shell",
      "command": "ssh",
      "args": [
        "hetzner",
        "cd /var/www/offmetabg && git pull origin master"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "VPS: Restart PHP-FPM",
      "type": "shell",
      "command": "ssh",
      "args": [
        "hetzner",
        "systemctl restart php8.1-fpm"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "VPS: Check Email Logs",
      "type": "shell",
      "command": "ssh",
      "args": [
        "hetzner",
        "tail -50 /var/www/offmetabg/storage/email-activity.log"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "VPS: Check Mail Queue",
      "type": "shell",
      "command": "ssh",
      "args": [
        "hetzner",
        "mailq"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "DNS: Add Email Records (Cloudflare)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-File",
        "${workspaceFolder}/add-email-dns.ps1"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Git: Commit and Push",
      "type": "shell",
      "command": "git",
      "args": [
        "add",
        ".",
        "&&",
        "git",
        "commit",
        "-m",
        "${input:commitMessage}",
        "&&",
        "git",
        "push",
        "origin",
        "master"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    }
  ],
  "inputs": [
    {
      "id": "commitMessage",
      "type": "promptString",
      "description": "Commit message",
      "default": "Update files"
    }
  ]
}
